# Task Specification and Taxonomy

## Overview

SeqFactorBench uses **synthetic sequence tasks** with well-defined input/output formats and ground truth. Tasks are generated by configurable programs so that difficulty can be controlled via the benchmark factors (scale, breadth, structure, noise).

---

## Task Families (Synthetic Sequence Tasks)

### 1. Sequence-to-Label (Classification)

| Family ID | Name              | Description                              | Output type   |
|-----------|-------------------|------------------------------------------|---------------|
| `seq2lab-parity`    | Parity / even-odd       | Binary label: even vs odd sum/count of tokens      | Single label  |
| `seq2lab-majority`  | Majority class          | Label of the most frequent symbol in the sequence   | Single label  |
| `seq2lab-depth`     | Max nesting depth       | Scalar label = max depth of brackets in sequence    | Single label  |
| `seq2lab-length-bin` | Length bucket        | Discrete bucket (e.g. short / medium / long)       | Single label  |
| `seq2lab-prefix`    | Prefix match            | Binary: sequence starts with a given prefix or not  | Single label  |
| `seq2lab-custom`    | Custom classifier       | User-defined rule over symbol sequence              | Single label  |

**Input format:** Sequence of token IDs (integer list or tensor).  
**Output format:** Single integer label in `[0, num_classes - 1]`.

---

### 2. Sequence-to-Sequence (Generation / Transduction)

| Family ID | Name              | Description                              | Output type   |
|-----------|-------------------|------------------------------------------|---------------|
| `seq2seq-copy`      | Copy                 | Output = input (identity)                 | Sequence      |
| `seq2seq-reverse`   | Reverse              | Output = input reversed                   | Sequence      |
| `seq2seq-sort`      | Sort                 | Output = input symbols sorted             | Sequence      |
| `seq2seq-shift`     | Shift (e.g. +1 mod V)| Output = input with each symbol shifted   | Sequence      |
| `seq2seq-select`    | Select positions     | Output = subset of positions by mask      | Sequence      |
| `seq2seq-bracket-close` | Bracket closing  | Output = well-formed closing for open brackets | Sequence |
| `seq2seq-custom`    | Custom transduction  | User-defined mapping input → output       | Sequence      |

**Input format:** Sequence of token IDs.  
**Output format:** Sequence of token IDs (same or different length by task).

---

### 3. Task Taxonomy Summary

| Category        | Task type        | Input format        | Output format       |
|-----------------|------------------|---------------------|---------------------|
| Classification  | Sequence-to-label| `[token_id, ...]`   | `label_id` (int)    |
| Transduction    | Sequence-to-sequence | `[token_id, ...]` | `[token_id, ...]`   |

---

## Input/Output Formats (Canonical)

### On disk / config

- **Input:** JSON or binary (e.g. NumPy/PyTorch) containing:
  - `input_ids`: list or array of integers, shape `(batch, seq_len)` or `(seq_len,)`.
  - Optional: `mask`, `lengths` for variable-length sequences.
- **Output (labels):**
  - **Seq2label:** `label_id`: int or array of shape `(batch,)`.
  - **Seq2seq:** `output_ids`: same structure as `input_ids` for target sequence.

### In-memory (training / eval)

- **Input:** Tensor or array of shape `(B, T)` with dtype integer (token indices).
- **Output:**
  - Seq2label: Tensor of shape `(B,)` (integer labels).
  - Seq2seq: Tensor of shape `(B, T_out)` (target token indices); padding and loss masking as needed.

---

## Extensibility

- New task families can be added by:
  1. Assigning a family ID and name.
  2. Defining the deterministic rule (or generator) for input → output.
  3. Registering in the task registry used by data generation and evaluation scripts.

Controllable parameters per task (sequence length, vocab size, noise, etc.) are defined in `parameters.md`.
